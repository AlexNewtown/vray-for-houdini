# V-Ray For Houdini Linux Launcher
#

# Use OpenVDB < 3
#
export HOUDINI13_VOLUME_COMPATIBILITY=1

export HOUDINI_VER_MAJOR=@HOUDINI_VERSION@
export HOUDINI_VER_FULL=${HOUDINI_VER_MAJOR}.@HOUDINI_VERSION_BUILD@

# DO NOT EDIT STUFF BELOW
#
LAUNCHER_FILEPATH=`readlink -f $0`
export LAUNCHER_LOCATION=`dirname ${LAUNCHER_FILEPATH}`

export HFS="/opt/hfs${HOUDINI_VER_FULL}"

export HOUDINI_USER_DIR=${HOME}/houdini${HOUDINI_VER_MAJOR}

# V-Ray Application SDK variables
export VRAY_SDK=${LAUNCHER_LOCATION}/appsdk
export VRAY_PATH=${VRAY_SDK}/bin

# Set VFB on top
export VRAY_VFB_ALWAYS_ON_TOP=1

# V-Ray JSON plugin descriptions
export VRAY_PLUGIN_DESC_PATH="${LAUNCHER_LOCATION}/plugins_desc"

# V-Ray UI dialog scripts
export VRAY_UI_DS_PATH="${LAUNCHER_LOCATION}/ui"

# V-Ray for Houdini dso path
export HOUDINI_DSO_PATH=${LAUNCHER_LOCATION}/dso:$HOUDINI_DSO_PATH
export HOUDINI_SCRIPT_PATH=${LAUNCHER_LOCATION}/deploy/scripts;${HOUDINI_SCRIPT_PATH}

# Phoenix Loaders
export VRAY_FOR_HOUDINI_AURA_LOADERS=${LAUNCHER_LOCATION}/deploy/lib

# Add libs to path
export PATH=${HFS}/bin:${VRAY_PATH}:${PATH}
export LD_LIBRARY_PATH=${VRAY_SDK}/bin:${VRAY_FOR_HOUDINI_AURA_LOADERS}:${LD_LIBRARY_PATH}

# Report loading errors
export HOUDINI_DSO_ERROR=1

# Install Files
mkdir -p "${HOUDINI_USER_DIR}/toolbar"
mkdir -p "${HOUDINI_USER_DIR}/config/Icons"
mkdir -p "${HOUDINI_USER_DIR}/presets"

cp -R "${LAUNCHER_LOCATION}/deploy/ROP_vray.svg"     "${HOUDINI_USER_DIR}/config/Icons/"
cp -R "${LAUNCHER_LOCATION}/deploy/presets"          "${HOUDINI_USER_DIR}/presets"

# Copy shelves
for SHELF_FILE in `find "${LAUNCHER_LOCATION}/deploy" -name "*.shelf"`; do
	cp -R "${SHELF_FILE}" "${HOUDINI_USER_DIR}/toolbar/"
done

# Start Houdini
"${HFS}/bin/houdini" -foreground $*
